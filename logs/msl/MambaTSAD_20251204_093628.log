[2025-12-04 09:36:28,242] [INFO] 日志已写入：./logs/msl/MambaTSAD_20251204_093628.log
[2025-12-04 09:36:28,246] [INFO] 参数配置：Namespace(dataset='msl', processed_root='./dataset/MSL', log_dir='./logs/msl', win_size=100, train_stride=1, test_stride=5, batch_size=64, epochs=50, lr=0.0001, weight_decay=0.005, seed=42, no_amp=True, max_grad_norm=1.0, patience=8, no_point_adjust=False)
[2025-12-04 09:36:28,333] [INFO] MSL 多通道数据集构建完成：entities=['C-1', 'C-2', 'D-14', 'D-15', 'D-16', 'F-4', 'F-5', 'F-7', 'F-8', 'M-1', 'M-2', 'M-3', 'M-4', 'M-5', 'M-6', 'M-7', 'P-10', 'P-11', 'P-14', 'P-15', 'S-2', 'T-12', 'T-13', 'T-4', 'T-5', 'T-8', 'T-9'], input_dim=55, len(train)=55644, len(test)=14223
[2025-12-04 09:36:31,513] [INFO] 模型结构：
MambaTSAD(
  (encoder): Linear(in_features=55, out_features=128, bias=True)
  (level1): ModuleList(
    (0-1): 2 x LSSBlockTS(
      (global_layers): ModuleList(
        (0-1): 2 x BiMambaBlock(
          (norm): LayerNorm((128,), eps=1e-05, elementwise_affine=True)
          (mamba_fwd): Mamba(
            (in_proj): Linear(in_features=128, out_features=512, bias=False)
            (conv1d): Conv1d(256, 256, kernel_size=(4,), stride=(1,), padding=(3,), groups=256)
            (act): SiLU()
            (x_proj): Linear(in_features=256, out_features=40, bias=False)
            (dt_proj): Linear(in_features=8, out_features=256, bias=True)
            (out_proj): Linear(in_features=256, out_features=128, bias=False)
          )
          (mamba_bwd): Mamba(
            (in_proj): Linear(in_features=128, out_features=512, bias=False)
            (conv1d): Conv1d(256, 256, kernel_size=(4,), stride=(1,), padding=(3,), groups=256)
            (act): SiLU()
            (x_proj): Linear(in_features=256, out_features=40, bias=False)
            (dt_proj): Linear(in_features=8, out_features=256, bias=True)
            (out_proj): Linear(in_features=256, out_features=128, bias=False)
          )
          (ffn): Sequential(
            (0): LayerNorm((128,), eps=1e-05, elementwise_affine=True)
            (1): Linear(in_features=128, out_features=512, bias=True)
            (2): GELU(approximate='none')
            (3): Dropout(p=0.1, inplace=False)
            (4): Linear(in_features=512, out_features=128, bias=True)
          )
          (dropout): Dropout(p=0.1, inplace=False)
        )
      )
      (local_branches): ModuleList(
        (0): LocalConvBlock1D(
          (block): Sequential(
            (0): Conv1d(128, 128, kernel_size=(1,), stride=(1,))
            (1): InstanceNorm1d(128, eps=1e-05, momentum=0.1, affine=False, track_running_stats=False)
            (2): SiLU()
            (3): Conv1d(128, 128, kernel_size=(5,), stride=(1,), padding=(2,), groups=128)
            (4): InstanceNorm1d(128, eps=1e-05, momentum=0.1, affine=False, track_running_stats=False)
            (5): SiLU()
            (6): Conv1d(128, 128, kernel_size=(1,), stride=(1,))
          )
        )
        (1): LocalConvBlock1D(
          (block): Sequential(
            (0): Conv1d(128, 128, kernel_size=(1,), stride=(1,))
            (1): InstanceNorm1d(128, eps=1e-05, momentum=0.1, affine=False, track_running_stats=False)
            (2): SiLU()
            (3): Conv1d(128, 128, kernel_size=(7,), stride=(1,), padding=(3,), groups=128)
            (4): InstanceNorm1d(128, eps=1e-05, momentum=0.1, affine=False, track_running_stats=False)
            (5): SiLU()
            (6): Conv1d(128, 128, kernel_size=(1,), stride=(1,))
          )
        )
      )
      (proj): Linear(in_features=384, out_features=128, bias=True)
    )
  )
  (level2): ModuleList(
    (0-1): 2 x LSSBlockTS(
      (global_layers): ModuleList(
        (0-1): 2 x BiMambaBlock(
          (norm): LayerNorm((128,), eps=1e-05, elementwise_affine=True)
          (mamba_fwd): Mamba(
            (in_proj): Linear(in_features=128, out_features=512, bias=False)
            (conv1d): Conv1d(256, 256, kernel_size=(4,), stride=(1,), padding=(3,), groups=256)
            (act): SiLU()
            (x_proj): Linear(in_features=256, out_features=40, bias=False)
            (dt_proj): Linear(in_features=8, out_features=256, bias=True)
            (out_proj): Linear(in_features=256, out_features=128, bias=False)
          )
          (mamba_bwd): Mamba(
            (in_proj): Linear(in_features=128, out_features=512, bias=False)
            (conv1d): Conv1d(256, 256, kernel_size=(4,), stride=(1,), padding=(3,), groups=256)
            (act): SiLU()
            (x_proj): Linear(in_features=256, out_features=40, bias=False)
            (dt_proj): Linear(in_features=8, out_features=256, bias=True)
            (out_proj): Linear(in_features=256, out_features=128, bias=False)
          )
          (ffn): Sequential(
            (0): LayerNorm((128,), eps=1e-05, elementwise_affine=True)
            (1): Linear(in_features=128, out_features=512, bias=True)
            (2): GELU(approximate='none')
            (3): Dropout(p=0.1, inplace=False)
            (4): Linear(in_features=512, out_features=128, bias=True)
          )
          (dropout): Dropout(p=0.1, inplace=False)
        )
      )
      (local_branches): ModuleList(
        (0): LocalConvBlock1D(
          (block): Sequential(
            (0): Conv1d(128, 128, kernel_size=(1,), stride=(1,))
            (1): InstanceNorm1d(128, eps=1e-05, momentum=0.1, affine=False, track_running_stats=False)
            (2): SiLU()
            (3): Conv1d(128, 128, kernel_size=(5,), stride=(1,), padding=(2,), groups=128)
            (4): InstanceNorm1d(128, eps=1e-05, momentum=0.1, affine=False, track_running_stats=False)
            (5): SiLU()
            (6): Conv1d(128, 128, kernel_size=(1,), stride=(1,))
          )
        )
        (1): LocalConvBlock1D(
          (block): Sequential(
            (0): Conv1d(128, 128, kernel_size=(1,), stride=(1,))
            (1): InstanceNorm1d(128, eps=1e-05, momentum=0.1, affine=False, track_running_stats=False)
            (2): SiLU()
            (3): Conv1d(128, 128, kernel_size=(7,), stride=(1,), padding=(3,), groups=128)
            (4): InstanceNorm1d(128, eps=1e-05, momentum=0.1, affine=False, track_running_stats=False)
            (5): SiLU()
            (6): Conv1d(128, 128, kernel_size=(1,), stride=(1,))
          )
        )
      )
      (proj): Linear(in_features=384, out_features=128, bias=True)
    )
  )
  (level3): ModuleList(
    (0-1): 2 x LSSBlockTS(
      (global_layers): ModuleList(
        (0-1): 2 x BiMambaBlock(
          (norm): LayerNorm((128,), eps=1e-05, elementwise_affine=True)
          (mamba_fwd): Mamba(
            (in_proj): Linear(in_features=128, out_features=512, bias=False)
            (conv1d): Conv1d(256, 256, kernel_size=(4,), stride=(1,), padding=(3,), groups=256)
            (act): SiLU()
            (x_proj): Linear(in_features=256, out_features=40, bias=False)
            (dt_proj): Linear(in_features=8, out_features=256, bias=True)
            (out_proj): Linear(in_features=256, out_features=128, bias=False)
          )
          (mamba_bwd): Mamba(
            (in_proj): Linear(in_features=128, out_features=512, bias=False)
            (conv1d): Conv1d(256, 256, kernel_size=(4,), stride=(1,), padding=(3,), groups=256)
            (act): SiLU()
            (x_proj): Linear(in_features=256, out_features=40, bias=False)
            (dt_proj): Linear(in_features=8, out_features=256, bias=True)
            (out_proj): Linear(in_features=256, out_features=128, bias=False)
          )
          (ffn): Sequential(
            (0): LayerNorm((128,), eps=1e-05, elementwise_affine=True)
            (1): Linear(in_features=128, out_features=512, bias=True)
            (2): GELU(approximate='none')
            (3): Dropout(p=0.1, inplace=False)
            (4): Linear(in_features=512, out_features=128, bias=True)
          )
          (dropout): Dropout(p=0.1, inplace=False)
        )
      )
      (local_branches): ModuleList(
        (0): LocalConvBlock1D(
          (block): Sequential(
            (0): Conv1d(128, 128, kernel_size=(1,), stride=(1,))
            (1): InstanceNorm1d(128, eps=1e-05, momentum=0.1, affine=False, track_running_stats=False)
            (2): SiLU()
            (3): Conv1d(128, 128, kernel_size=(5,), stride=(1,), padding=(2,), groups=128)
            (4): InstanceNorm1d(128, eps=1e-05, momentum=0.1, affine=False, track_running_stats=False)
            (5): SiLU()
            (6): Conv1d(128, 128, kernel_size=(1,), stride=(1,))
          )
        )
        (1): LocalConvBlock1D(
          (block): Sequential(
            (0): Conv1d(128, 128, kernel_size=(1,), stride=(1,))
            (1): InstanceNorm1d(128, eps=1e-05, momentum=0.1, affine=False, track_running_stats=False)
            (2): SiLU()
            (3): Conv1d(128, 128, kernel_size=(7,), stride=(1,), padding=(3,), groups=128)
            (4): InstanceNorm1d(128, eps=1e-05, momentum=0.1, affine=False, track_running_stats=False)
            (5): SiLU()
            (6): Conv1d(128, 128, kernel_size=(1,), stride=(1,))
          )
        )
      )
      (proj): Linear(in_features=384, out_features=128, bias=True)
    )
  )
  (decoder): Linear(in_features=128, out_features=55, bias=True)
)
[2025-12-04 09:36:31,515] [INFO] ========== Epoch 1/50 ==========
[2025-12-04 09:38:02,997] [INFO] 本 epoch 平均训练损失: 0.897853
[2025-12-04 09:38:34,816] [INFO] [Eval] F1=0.8709, P=0.8882, R=0.8542, AUC=0.5396, thr=1.858696, point_adjust=True
[2025-12-04 09:38:34,871] [INFO] 发现更优模型，已保存至 ./logs/msl/best_model.pt
[2025-12-04 09:38:35,134] [INFO] 已保存可视化图：./logs/msl/scores_epoch1.png
[2025-12-04 09:38:35,134] [INFO] ========== Epoch 2/50 ==========
[2025-12-04 09:40:06,558] [INFO] 本 epoch 平均训练损失: 0.716851
[2025-12-04 09:40:37,470] [INFO] [Eval] F1=0.8726, P=0.8918, R=0.8542, AUC=0.5406, thr=1.964110, point_adjust=True
[2025-12-04 09:40:37,562] [INFO] 发现更优模型，已保存至 ./logs/msl/best_model.pt
[2025-12-04 09:40:37,812] [INFO] 已保存可视化图：./logs/msl/scores_epoch2.png
[2025-12-04 09:40:37,812] [INFO] ========== Epoch 3/50 ==========
[2025-12-04 09:42:08,023] [INFO] 本 epoch 平均训练损失: 0.705044
[2025-12-04 09:42:39,780] [INFO] [Eval] F1=0.8727, P=0.8919, R=0.8542, AUC=0.5430, thr=2.000157, point_adjust=True
[2025-12-04 09:42:40,028] [INFO] 已保存可视化图：./logs/msl/scores_epoch3.png
[2025-12-04 09:42:40,028] [INFO] ========== Epoch 4/50 ==========
[2025-12-04 09:44:04,972] [INFO] 本 epoch 平均训练损失: 0.699233
[2025-12-04 09:44:35,435] [INFO] [Eval] F1=0.8727, P=0.8920, R=0.8542, AUC=0.5435, thr=1.987140, point_adjust=True
[2025-12-04 09:44:35,528] [INFO] 发现更优模型，已保存至 ./logs/msl/best_model.pt
[2025-12-04 09:44:35,778] [INFO] 已保存可视化图：./logs/msl/scores_epoch4.png
[2025-12-04 09:44:35,778] [INFO] ========== Epoch 5/50 ==========
[2025-12-04 09:45:55,187] [INFO] 本 epoch 平均训练损失: 0.695308
[2025-12-04 09:46:24,783] [INFO] [Eval] F1=0.8713, P=0.8988, R=0.8454, AUC=0.5453, thr=2.150800, point_adjust=True
[2025-12-04 09:46:25,034] [INFO] 已保存可视化图：./logs/msl/scores_epoch5.png
[2025-12-04 09:46:25,034] [INFO] ========== Epoch 6/50 ==========
[2025-12-04 09:47:51,659] [INFO] 本 epoch 平均训练损失: 0.692701
[2025-12-04 09:48:21,470] [INFO] [Eval] F1=0.8712, P=0.8986, R=0.8454, AUC=0.5465, thr=2.114319, point_adjust=True
[2025-12-04 09:48:21,723] [INFO] 已保存可视化图：./logs/msl/scores_epoch6.png
[2025-12-04 09:48:21,723] [INFO] ========== Epoch 7/50 ==========
[2025-12-04 09:49:50,199] [INFO] 本 epoch 平均训练损失: 0.691088
[2025-12-04 09:50:19,557] [INFO] [Eval] F1=0.8710, P=0.8884, R=0.8542, AUC=0.5472, thr=1.927894, point_adjust=True
[2025-12-04 09:50:19,811] [INFO] 已保存可视化图：./logs/msl/scores_epoch7.png
[2025-12-04 09:50:19,811] [INFO] ========== Epoch 8/50 ==========
[2025-12-04 09:51:39,875] [INFO] 本 epoch 平均训练损失: 0.689510
[2025-12-04 09:52:11,580] [INFO] [Eval] F1=0.8711, P=0.8887, R=0.8542, AUC=0.5478, thr=1.844946, point_adjust=True
[2025-12-04 09:52:11,831] [INFO] 已保存可视化图：./logs/msl/scores_epoch8.png
[2025-12-04 09:52:11,831] [INFO] ========== Epoch 9/50 ==========
[2025-12-04 09:53:37,126] [INFO] 本 epoch 平均训练损失: 0.688266
[2025-12-04 09:54:08,400] [INFO] [Eval] F1=0.8709, P=0.8883, R=0.8542, AUC=0.5479, thr=1.882588, point_adjust=True
[2025-12-04 09:54:08,653] [INFO] 已保存可视化图：./logs/msl/scores_epoch9.png
[2025-12-04 09:54:08,653] [INFO] ========== Epoch 10/50 ==========
[2025-12-04 09:55:34,018] [INFO] 本 epoch 平均训练损失: 0.687153
[2025-12-04 09:56:04,488] [INFO] [Eval] F1=0.8711, P=0.8886, R=0.8542, AUC=0.5488, thr=1.873763, point_adjust=True
[2025-12-04 09:56:04,743] [INFO] 已保存可视化图：./logs/msl/scores_epoch10.png
[2025-12-04 09:56:04,743] [INFO] ========== Epoch 11/50 ==========
[2025-12-04 09:57:27,782] [INFO] 本 epoch 平均训练损失: 0.686250
[2025-12-04 09:57:59,086] [INFO] [Eval] F1=0.8695, P=0.8950, R=0.8454, AUC=0.5493, thr=1.978393, point_adjust=True
[2025-12-04 09:57:59,336] [INFO] 已保存可视化图：./logs/msl/scores_epoch11.png
[2025-12-04 09:57:59,336] [INFO] ========== Epoch 12/50 ==========
[2025-12-04 09:59:28,699] [INFO] 本 epoch 平均训练损失: 0.685486
[2025-12-04 09:59:58,836] [INFO] [Eval] F1=0.8695, P=0.8950, R=0.8454, AUC=0.5497, thr=2.004628, point_adjust=True
[2025-12-04 09:59:58,836] [INFO] 早停触发：连续 8 个 epoch F1 未提升，在第 12 个 epoch 停止训练。
[2025-12-04 09:59:58,837] [INFO] 训练结束，最佳 F1=0.8727, 最佳指标={'precision': 0.8920263547117224, 'recall': 0.8542364151418308, 'f1': 0.8727224839836312, 'auc': 0.5434520688556355, 'threshold': 1.9871398091316224, 'use_point_adjust': True}
