[2025-12-03 12:02:34,243] [INFO] 日志已写入：./logs/smd_all/MambaTSAD_20251203_120234.log
[2025-12-03 12:02:34,244] [INFO] 参数配置：Namespace(processed_root='./dataset/SMD', log_dir='./logs/smd_all', win_size=100, train_stride=1, test_stride=5, batch_size=64, epochs=50, lr=0.001, weight_decay=0.0001, seed=42, no_amp=True, max_grad_norm=1.0, patience=8, no_point_adjust=False)
[2025-12-03 12:02:35,067] [INFO] SMD 多机数据集构建完成：machines=['machine-1-1', 'machine-1-2', 'machine-1-3', 'machine-1-4', 'machine-1-5', 'machine-1-6', 'machine-1-7', 'machine-1-8', 'machine-2-1', 'machine-2-2', 'machine-2-3', 'machine-2-4', 'machine-2-5', 'machine-2-6', 'machine-2-7', 'machine-2-8', 'machine-2-9', 'machine-3-1', 'machine-3-10', 'machine-3-11', 'machine-3-2', 'machine-3-3', 'machine-3-4', 'machine-3-5', 'machine-3-6', 'machine-3-7', 'machine-3-8', 'machine-3-9'], input_dim=38, len(train)=705633, len(test)=141138
[2025-12-03 12:02:36,250] [INFO] 模型结构：
MambaTSAD(
  (encoder): Linear(in_features=38, out_features=256, bias=True)
  (level1): ModuleList(
    (0-1): 2 x LSSBlockTS(
      (global_layers): ModuleList(
        (0-1): 2 x BiMambaBlock(
          (norm): LayerNorm((256,), eps=1e-05, elementwise_affine=True)
          (mamba_fwd): Mamba(
            (in_proj): Linear(in_features=256, out_features=1024, bias=False)
            (conv1d): Conv1d(512, 512, kernel_size=(4,), stride=(1,), padding=(3,), groups=512)
            (act): SiLU()
            (x_proj): Linear(in_features=512, out_features=48, bias=False)
            (dt_proj): Linear(in_features=16, out_features=512, bias=True)
            (out_proj): Linear(in_features=512, out_features=256, bias=False)
          )
          (mamba_bwd): Mamba(
            (in_proj): Linear(in_features=256, out_features=1024, bias=False)
            (conv1d): Conv1d(512, 512, kernel_size=(4,), stride=(1,), padding=(3,), groups=512)
            (act): SiLU()
            (x_proj): Linear(in_features=512, out_features=48, bias=False)
            (dt_proj): Linear(in_features=16, out_features=512, bias=True)
            (out_proj): Linear(in_features=512, out_features=256, bias=False)
          )
          (ffn): Sequential(
            (0): LayerNorm((256,), eps=1e-05, elementwise_affine=True)
            (1): Linear(in_features=256, out_features=1024, bias=True)
            (2): GELU(approximate='none')
            (3): Dropout(p=0.1, inplace=False)
            (4): Linear(in_features=1024, out_features=256, bias=True)
          )
          (dropout): Dropout(p=0.1, inplace=False)
        )
      )
      (local_branches): ModuleList(
        (0): LocalConvBlock1D(
          (block): Sequential(
            (0): Conv1d(256, 256, kernel_size=(1,), stride=(1,))
            (1): InstanceNorm1d(256, eps=1e-05, momentum=0.1, affine=False, track_running_stats=False)
            (2): SiLU()
            (3): Conv1d(256, 256, kernel_size=(5,), stride=(1,), padding=(2,), groups=256)
            (4): InstanceNorm1d(256, eps=1e-05, momentum=0.1, affine=False, track_running_stats=False)
            (5): SiLU()
            (6): Conv1d(256, 256, kernel_size=(1,), stride=(1,))
          )
        )
        (1): LocalConvBlock1D(
          (block): Sequential(
            (0): Conv1d(256, 256, kernel_size=(1,), stride=(1,))
            (1): InstanceNorm1d(256, eps=1e-05, momentum=0.1, affine=False, track_running_stats=False)
            (2): SiLU()
            (3): Conv1d(256, 256, kernel_size=(7,), stride=(1,), padding=(3,), groups=256)
            (4): InstanceNorm1d(256, eps=1e-05, momentum=0.1, affine=False, track_running_stats=False)
            (5): SiLU()
            (6): Conv1d(256, 256, kernel_size=(1,), stride=(1,))
          )
        )
      )
      (proj): Linear(in_features=768, out_features=256, bias=True)
    )
  )
  (level2): ModuleList(
    (0-1): 2 x LSSBlockTS(
      (global_layers): ModuleList(
        (0-1): 2 x BiMambaBlock(
          (norm): LayerNorm((256,), eps=1e-05, elementwise_affine=True)
          (mamba_fwd): Mamba(
            (in_proj): Linear(in_features=256, out_features=1024, bias=False)
            (conv1d): Conv1d(512, 512, kernel_size=(4,), stride=(1,), padding=(3,), groups=512)
            (act): SiLU()
            (x_proj): Linear(in_features=512, out_features=48, bias=False)
            (dt_proj): Linear(in_features=16, out_features=512, bias=True)
            (out_proj): Linear(in_features=512, out_features=256, bias=False)
          )
          (mamba_bwd): Mamba(
            (in_proj): Linear(in_features=256, out_features=1024, bias=False)
            (conv1d): Conv1d(512, 512, kernel_size=(4,), stride=(1,), padding=(3,), groups=512)
            (act): SiLU()
            (x_proj): Linear(in_features=512, out_features=48, bias=False)
            (dt_proj): Linear(in_features=16, out_features=512, bias=True)
            (out_proj): Linear(in_features=512, out_features=256, bias=False)
          )
          (ffn): Sequential(
            (0): LayerNorm((256,), eps=1e-05, elementwise_affine=True)
            (1): Linear(in_features=256, out_features=1024, bias=True)
            (2): GELU(approximate='none')
            (3): Dropout(p=0.1, inplace=False)
            (4): Linear(in_features=1024, out_features=256, bias=True)
          )
          (dropout): Dropout(p=0.1, inplace=False)
        )
      )
      (local_branches): ModuleList(
        (0): LocalConvBlock1D(
          (block): Sequential(
            (0): Conv1d(256, 256, kernel_size=(1,), stride=(1,))
            (1): InstanceNorm1d(256, eps=1e-05, momentum=0.1, affine=False, track_running_stats=False)
            (2): SiLU()
            (3): Conv1d(256, 256, kernel_size=(5,), stride=(1,), padding=(2,), groups=256)
            (4): InstanceNorm1d(256, eps=1e-05, momentum=0.1, affine=False, track_running_stats=False)
            (5): SiLU()
            (6): Conv1d(256, 256, kernel_size=(1,), stride=(1,))
          )
        )
        (1): LocalConvBlock1D(
          (block): Sequential(
            (0): Conv1d(256, 256, kernel_size=(1,), stride=(1,))
            (1): InstanceNorm1d(256, eps=1e-05, momentum=0.1, affine=False, track_running_stats=False)
            (2): SiLU()
            (3): Conv1d(256, 256, kernel_size=(7,), stride=(1,), padding=(3,), groups=256)
            (4): InstanceNorm1d(256, eps=1e-05, momentum=0.1, affine=False, track_running_stats=False)
            (5): SiLU()
            (6): Conv1d(256, 256, kernel_size=(1,), stride=(1,))
          )
        )
      )
      (proj): Linear(in_features=768, out_features=256, bias=True)
    )
  )
  (level3): ModuleList(
    (0-1): 2 x LSSBlockTS(
      (global_layers): ModuleList(
        (0-1): 2 x BiMambaBlock(
          (norm): LayerNorm((256,), eps=1e-05, elementwise_affine=True)
          (mamba_fwd): Mamba(
            (in_proj): Linear(in_features=256, out_features=1024, bias=False)
            (conv1d): Conv1d(512, 512, kernel_size=(4,), stride=(1,), padding=(3,), groups=512)
            (act): SiLU()
            (x_proj): Linear(in_features=512, out_features=48, bias=False)
            (dt_proj): Linear(in_features=16, out_features=512, bias=True)
            (out_proj): Linear(in_features=512, out_features=256, bias=False)
          )
          (mamba_bwd): Mamba(
            (in_proj): Linear(in_features=256, out_features=1024, bias=False)
            (conv1d): Conv1d(512, 512, kernel_size=(4,), stride=(1,), padding=(3,), groups=512)
            (act): SiLU()
            (x_proj): Linear(in_features=512, out_features=48, bias=False)
            (dt_proj): Linear(in_features=16, out_features=512, bias=True)
            (out_proj): Linear(in_features=512, out_features=256, bias=False)
          )
          (ffn): Sequential(
            (0): LayerNorm((256,), eps=1e-05, elementwise_affine=True)
            (1): Linear(in_features=256, out_features=1024, bias=True)
            (2): GELU(approximate='none')
            (3): Dropout(p=0.1, inplace=False)
            (4): Linear(in_features=1024, out_features=256, bias=True)
          )
          (dropout): Dropout(p=0.1, inplace=False)
        )
      )
      (local_branches): ModuleList(
        (0): LocalConvBlock1D(
          (block): Sequential(
            (0): Conv1d(256, 256, kernel_size=(1,), stride=(1,))
            (1): InstanceNorm1d(256, eps=1e-05, momentum=0.1, affine=False, track_running_stats=False)
            (2): SiLU()
            (3): Conv1d(256, 256, kernel_size=(5,), stride=(1,), padding=(2,), groups=256)
            (4): InstanceNorm1d(256, eps=1e-05, momentum=0.1, affine=False, track_running_stats=False)
            (5): SiLU()
            (6): Conv1d(256, 256, kernel_size=(1,), stride=(1,))
          )
        )
        (1): LocalConvBlock1D(
          (block): Sequential(
            (0): Conv1d(256, 256, kernel_size=(1,), stride=(1,))
            (1): InstanceNorm1d(256, eps=1e-05, momentum=0.1, affine=False, track_running_stats=False)
            (2): SiLU()
            (3): Conv1d(256, 256, kernel_size=(7,), stride=(1,), padding=(3,), groups=256)
            (4): InstanceNorm1d(256, eps=1e-05, momentum=0.1, affine=False, track_running_stats=False)
            (5): SiLU()
            (6): Conv1d(256, 256, kernel_size=(1,), stride=(1,))
          )
        )
      )
      (proj): Linear(in_features=768, out_features=256, bias=True)
    )
  )
  (decoder): Linear(in_features=256, out_features=38, bias=True)
)
[2025-12-03 12:02:36,251] [INFO] ========== Epoch 1/50 ==========
[2025-12-03 12:20:33,602] [INFO] 本 epoch 平均训练损失: 15.668686
[2025-12-03 12:25:27,665] [INFO] [Eval] F1=0.6097, P=0.4512, R=0.9400, AUC=0.7545, thr=1.342372, point_adjust=True
[2025-12-03 12:25:27,938] [INFO] 发现更优模型，已保存至 ./logs/smd_all/best_model.pt
[2025-12-03 12:25:28,223] [INFO] 已保存可视化图：./logs/smd_all/scores_epoch1.png
[2025-12-03 12:25:28,223] [INFO] ========== Epoch 2/50 ==========
[2025-12-03 12:43:12,986] [INFO] 本 epoch 平均训练损失: 6.802498
[2025-12-03 12:48:09,401] [INFO] [Eval] F1=0.8443, P=0.8814, R=0.8102, AUC=0.7489, thr=5.457923, point_adjust=True
[2025-12-03 12:48:09,688] [INFO] 发现更优模型，已保存至 ./logs/smd_all/best_model.pt
[2025-12-03 12:48:09,929] [INFO] 已保存可视化图：./logs/smd_all/scores_epoch2.png
[2025-12-03 12:48:09,930] [INFO] ========== Epoch 3/50 ==========
[2025-12-03 13:07:00,203] [INFO] 本 epoch 平均训练损失: 0.487917
[2025-12-03 13:11:55,233] [INFO] [Eval] F1=0.8279, P=0.9175, R=0.7542, AUC=0.7515, thr=8.562677, point_adjust=True
[2025-12-03 13:11:55,478] [INFO] 已保存可视化图：./logs/smd_all/scores_epoch3.png
[2025-12-03 13:11:55,478] [INFO] ========== Epoch 4/50 ==========
[2025-12-03 13:29:26,160] [INFO] 本 epoch 平均训练损失: 0.431604
[2025-12-03 13:34:21,226] [INFO] [Eval] F1=0.8266, P=0.9140, R=0.7545, AUC=0.7490, thr=8.647352, point_adjust=True
[2025-12-03 13:34:21,470] [INFO] 已保存可视化图：./logs/smd_all/scores_epoch4.png
[2025-12-03 13:34:21,470] [INFO] ========== Epoch 5/50 ==========
[2025-12-03 14:09:42,377] [INFO] 本 epoch 平均训练损失: 0.457289
[2025-12-03 14:16:01,672] [INFO] [Eval] F1=0.8260, P=0.9120, R=0.7548, AUC=0.7501, thr=8.009028, point_adjust=True
[2025-12-03 14:16:01,915] [INFO] 已保存可视化图：./logs/smd_all/scores_epoch5.png
[2025-12-03 14:16:01,915] [INFO] ========== Epoch 6/50 ==========
[2025-12-03 14:52:07,848] [INFO] 本 epoch 平均训练损失: 0.434348
[2025-12-03 14:58:19,035] [INFO] [Eval] F1=0.8269, P=0.9124, R=0.7560, AUC=0.7475, thr=7.359075, point_adjust=True
[2025-12-03 14:58:19,279] [INFO] 已保存可视化图：./logs/smd_all/scores_epoch6.png
[2025-12-03 14:58:19,279] [INFO] ========== Epoch 7/50 ==========
[2025-12-03 15:34:22,687] [INFO] 本 epoch 平均训练损失: 0.434337
[2025-12-03 15:40:28,929] [INFO] [Eval] F1=0.8297, P=0.9223, R=0.7540, AUC=0.7478, thr=8.438595, point_adjust=True
[2025-12-03 15:40:29,195] [INFO] 已保存可视化图：./logs/smd_all/scores_epoch7.png
[2025-12-03 15:40:29,196] [INFO] ========== Epoch 8/50 ==========
