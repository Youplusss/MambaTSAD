[2025-12-03 17:30:37,949] [INFO] 日志已写入：./logs/smd_all/MambaTSAD_20251203_173037.log
[2025-12-03 17:30:37,950] [INFO] 参数配置：Namespace(processed_root='./dataset/SMD', log_dir='./logs/smd_all', win_size=100, train_stride=2, test_stride=5, batch_size=64, epochs=50, lr=0.0001, weight_decay=0.005, seed=42, no_amp=True, max_grad_norm=1.0, patience=8, no_point_adjust=False)
[2025-12-03 17:30:38,774] [INFO] SMD 多机数据集构建完成：machines=['machine-1-1', 'machine-1-2', 'machine-1-3', 'machine-1-4', 'machine-1-5', 'machine-1-6', 'machine-1-7', 'machine-1-8', 'machine-2-1', 'machine-2-2', 'machine-2-3', 'machine-2-4', 'machine-2-5', 'machine-2-6', 'machine-2-7', 'machine-2-8', 'machine-2-9', 'machine-3-1', 'machine-3-10', 'machine-3-11', 'machine-3-2', 'machine-3-3', 'machine-3-4', 'machine-3-5', 'machine-3-6', 'machine-3-7', 'machine-3-8', 'machine-3-9'], input_dim=38, len(train)=352824, len(test)=141138
[2025-12-03 17:30:39,958] [INFO] 模型结构：
MambaTSAD(
  (encoder): Linear(in_features=38, out_features=128, bias=True)
  (level1): ModuleList(
    (0-1): 2 x LSSBlockTS(
      (global_layers): ModuleList(
        (0-1): 2 x BiMambaBlock(
          (norm): LayerNorm((128,), eps=1e-05, elementwise_affine=True)
          (mamba_fwd): Mamba(
            (in_proj): Linear(in_features=128, out_features=512, bias=False)
            (conv1d): Conv1d(256, 256, kernel_size=(4,), stride=(1,), padding=(3,), groups=256)
            (act): SiLU()
            (x_proj): Linear(in_features=256, out_features=40, bias=False)
            (dt_proj): Linear(in_features=8, out_features=256, bias=True)
            (out_proj): Linear(in_features=256, out_features=128, bias=False)
          )
          (mamba_bwd): Mamba(
            (in_proj): Linear(in_features=128, out_features=512, bias=False)
            (conv1d): Conv1d(256, 256, kernel_size=(4,), stride=(1,), padding=(3,), groups=256)
            (act): SiLU()
            (x_proj): Linear(in_features=256, out_features=40, bias=False)
            (dt_proj): Linear(in_features=8, out_features=256, bias=True)
            (out_proj): Linear(in_features=256, out_features=128, bias=False)
          )
          (ffn): Sequential(
            (0): LayerNorm((128,), eps=1e-05, elementwise_affine=True)
            (1): Linear(in_features=128, out_features=512, bias=True)
            (2): GELU(approximate='none')
            (3): Dropout(p=0.1, inplace=False)
            (4): Linear(in_features=512, out_features=128, bias=True)
          )
          (dropout): Dropout(p=0.1, inplace=False)
        )
      )
      (local_branches): ModuleList(
        (0): LocalConvBlock1D(
          (block): Sequential(
            (0): Conv1d(128, 128, kernel_size=(1,), stride=(1,))
            (1): InstanceNorm1d(128, eps=1e-05, momentum=0.1, affine=False, track_running_stats=False)
            (2): SiLU()
            (3): Conv1d(128, 128, kernel_size=(5,), stride=(1,), padding=(2,), groups=128)
            (4): InstanceNorm1d(128, eps=1e-05, momentum=0.1, affine=False, track_running_stats=False)
            (5): SiLU()
            (6): Conv1d(128, 128, kernel_size=(1,), stride=(1,))
          )
        )
        (1): LocalConvBlock1D(
          (block): Sequential(
            (0): Conv1d(128, 128, kernel_size=(1,), stride=(1,))
            (1): InstanceNorm1d(128, eps=1e-05, momentum=0.1, affine=False, track_running_stats=False)
            (2): SiLU()
            (3): Conv1d(128, 128, kernel_size=(7,), stride=(1,), padding=(3,), groups=128)
            (4): InstanceNorm1d(128, eps=1e-05, momentum=0.1, affine=False, track_running_stats=False)
            (5): SiLU()
            (6): Conv1d(128, 128, kernel_size=(1,), stride=(1,))
          )
        )
      )
      (proj): Linear(in_features=384, out_features=128, bias=True)
    )
  )
  (level2): ModuleList(
    (0-1): 2 x LSSBlockTS(
      (global_layers): ModuleList(
        (0-1): 2 x BiMambaBlock(
          (norm): LayerNorm((128,), eps=1e-05, elementwise_affine=True)
          (mamba_fwd): Mamba(
            (in_proj): Linear(in_features=128, out_features=512, bias=False)
            (conv1d): Conv1d(256, 256, kernel_size=(4,), stride=(1,), padding=(3,), groups=256)
            (act): SiLU()
            (x_proj): Linear(in_features=256, out_features=40, bias=False)
            (dt_proj): Linear(in_features=8, out_features=256, bias=True)
            (out_proj): Linear(in_features=256, out_features=128, bias=False)
          )
          (mamba_bwd): Mamba(
            (in_proj): Linear(in_features=128, out_features=512, bias=False)
            (conv1d): Conv1d(256, 256, kernel_size=(4,), stride=(1,), padding=(3,), groups=256)
            (act): SiLU()
            (x_proj): Linear(in_features=256, out_features=40, bias=False)
            (dt_proj): Linear(in_features=8, out_features=256, bias=True)
            (out_proj): Linear(in_features=256, out_features=128, bias=False)
          )
          (ffn): Sequential(
            (0): LayerNorm((128,), eps=1e-05, elementwise_affine=True)
            (1): Linear(in_features=128, out_features=512, bias=True)
            (2): GELU(approximate='none')
            (3): Dropout(p=0.1, inplace=False)
            (4): Linear(in_features=512, out_features=128, bias=True)
          )
          (dropout): Dropout(p=0.1, inplace=False)
        )
      )
      (local_branches): ModuleList(
        (0): LocalConvBlock1D(
          (block): Sequential(
            (0): Conv1d(128, 128, kernel_size=(1,), stride=(1,))
            (1): InstanceNorm1d(128, eps=1e-05, momentum=0.1, affine=False, track_running_stats=False)
            (2): SiLU()
            (3): Conv1d(128, 128, kernel_size=(5,), stride=(1,), padding=(2,), groups=128)
            (4): InstanceNorm1d(128, eps=1e-05, momentum=0.1, affine=False, track_running_stats=False)
            (5): SiLU()
            (6): Conv1d(128, 128, kernel_size=(1,), stride=(1,))
          )
        )
        (1): LocalConvBlock1D(
          (block): Sequential(
            (0): Conv1d(128, 128, kernel_size=(1,), stride=(1,))
            (1): InstanceNorm1d(128, eps=1e-05, momentum=0.1, affine=False, track_running_stats=False)
            (2): SiLU()
            (3): Conv1d(128, 128, kernel_size=(7,), stride=(1,), padding=(3,), groups=128)
            (4): InstanceNorm1d(128, eps=1e-05, momentum=0.1, affine=False, track_running_stats=False)
            (5): SiLU()
            (6): Conv1d(128, 128, kernel_size=(1,), stride=(1,))
          )
        )
      )
      (proj): Linear(in_features=384, out_features=128, bias=True)
    )
  )
  (level3): ModuleList(
    (0-1): 2 x LSSBlockTS(
      (global_layers): ModuleList(
        (0-1): 2 x BiMambaBlock(
          (norm): LayerNorm((128,), eps=1e-05, elementwise_affine=True)
          (mamba_fwd): Mamba(
            (in_proj): Linear(in_features=128, out_features=512, bias=False)
            (conv1d): Conv1d(256, 256, kernel_size=(4,), stride=(1,), padding=(3,), groups=256)
            (act): SiLU()
            (x_proj): Linear(in_features=256, out_features=40, bias=False)
            (dt_proj): Linear(in_features=8, out_features=256, bias=True)
            (out_proj): Linear(in_features=256, out_features=128, bias=False)
          )
          (mamba_bwd): Mamba(
            (in_proj): Linear(in_features=128, out_features=512, bias=False)
            (conv1d): Conv1d(256, 256, kernel_size=(4,), stride=(1,), padding=(3,), groups=256)
            (act): SiLU()
            (x_proj): Linear(in_features=256, out_features=40, bias=False)
            (dt_proj): Linear(in_features=8, out_features=256, bias=True)
            (out_proj): Linear(in_features=256, out_features=128, bias=False)
          )
          (ffn): Sequential(
            (0): LayerNorm((128,), eps=1e-05, elementwise_affine=True)
            (1): Linear(in_features=128, out_features=512, bias=True)
            (2): GELU(approximate='none')
            (3): Dropout(p=0.1, inplace=False)
            (4): Linear(in_features=512, out_features=128, bias=True)
          )
          (dropout): Dropout(p=0.1, inplace=False)
        )
      )
      (local_branches): ModuleList(
        (0): LocalConvBlock1D(
          (block): Sequential(
            (0): Conv1d(128, 128, kernel_size=(1,), stride=(1,))
            (1): InstanceNorm1d(128, eps=1e-05, momentum=0.1, affine=False, track_running_stats=False)
            (2): SiLU()
            (3): Conv1d(128, 128, kernel_size=(5,), stride=(1,), padding=(2,), groups=128)
            (4): InstanceNorm1d(128, eps=1e-05, momentum=0.1, affine=False, track_running_stats=False)
            (5): SiLU()
            (6): Conv1d(128, 128, kernel_size=(1,), stride=(1,))
          )
        )
        (1): LocalConvBlock1D(
          (block): Sequential(
            (0): Conv1d(128, 128, kernel_size=(1,), stride=(1,))
            (1): InstanceNorm1d(128, eps=1e-05, momentum=0.1, affine=False, track_running_stats=False)
            (2): SiLU()
            (3): Conv1d(128, 128, kernel_size=(7,), stride=(1,), padding=(3,), groups=128)
            (4): InstanceNorm1d(128, eps=1e-05, momentum=0.1, affine=False, track_running_stats=False)
            (5): SiLU()
            (6): Conv1d(128, 128, kernel_size=(1,), stride=(1,))
          )
        )
      )
      (proj): Linear(in_features=384, out_features=128, bias=True)
    )
  )
  (decoder): Linear(in_features=128, out_features=38, bias=True)
)
[2025-12-03 17:30:39,960] [INFO] ========== Epoch 1/50 ==========
[2025-12-03 17:37:35,290] [INFO] 本 epoch 平均训练损失: 0.487379
[2025-12-03 17:42:04,357] [INFO] [Eval] F1=0.5587, P=0.9654, R=0.3931, AUC=0.7464, thr=195.749179, point_adjust=True
[2025-12-03 17:42:04,461] [INFO] 发现更优模型，已保存至 ./logs/smd_all/best_model.pt
[2025-12-03 17:42:04,717] [INFO] 已保存可视化图：./logs/smd_all/scores_epoch1.png
[2025-12-03 17:42:04,717] [INFO] ========== Epoch 2/50 ==========
[2025-12-03 17:49:10,313] [INFO] 本 epoch 平均训练损失: 0.428914
[2025-12-03 17:53:42,343] [INFO] [Eval] F1=0.7147, P=0.9225, R=0.5833, AUC=0.7467, thr=23.426533, point_adjust=True
[2025-12-03 17:53:42,438] [INFO] 发现更优模型，已保存至 ./logs/smd_all/best_model.pt
[2025-12-03 17:53:42,673] [INFO] 已保存可视化图：./logs/smd_all/scores_epoch2.png
[2025-12-03 17:53:42,673] [INFO] ========== Epoch 3/50 ==========
[2025-12-03 18:00:45,660] [INFO] 本 epoch 平均训练损失: 0.425560
[2025-12-03 18:05:17,827] [INFO] [Eval] F1=0.8410, P=0.8850, R=0.8012, AUC=0.7478, thr=5.564838, point_adjust=True
[2025-12-03 18:05:17,923] [INFO] 发现更优模型，已保存至 ./logs/smd_all/best_model.pt
[2025-12-03 18:05:18,167] [INFO] 已保存可视化图：./logs/smd_all/scores_epoch3.png
[2025-12-03 18:05:18,167] [INFO] ========== Epoch 4/50 ==========
[2025-12-03 18:12:17,796] [INFO] 本 epoch 平均训练损失: 0.423877
[2025-12-03 18:16:50,156] [INFO] [Eval] F1=0.8715, P=0.8890, R=0.8547, AUC=0.7469, thr=3.497951, point_adjust=True
[2025-12-03 18:16:50,255] [INFO] 发现更优模型，已保存至 ./logs/smd_all/best_model.pt
[2025-12-03 18:16:50,496] [INFO] 已保存可视化图：./logs/smd_all/scores_epoch4.png
[2025-12-03 18:16:50,496] [INFO] ========== Epoch 5/50 ==========
[2025-12-03 18:23:46,535] [INFO] 本 epoch 平均训练损失: 0.422808
[2025-12-03 18:28:20,663] [INFO] [Eval] F1=0.8739, P=0.8848, R=0.8633, AUC=0.7469, thr=2.967212, point_adjust=True
[2025-12-03 18:28:20,760] [INFO] 发现更优模型，已保存至 ./logs/smd_all/best_model.pt
[2025-12-03 18:28:21,002] [INFO] 已保存可视化图：./logs/smd_all/scores_epoch5.png
[2025-12-03 18:28:21,002] [INFO] ========== Epoch 6/50 ==========
[2025-12-03 18:35:26,319] [INFO] 本 epoch 平均训练损失: 0.422008
[2025-12-03 18:39:58,261] [INFO] [Eval] F1=0.8770, P=0.8813, R=0.8727, AUC=0.7466, thr=2.708657, point_adjust=True
[2025-12-03 18:39:58,357] [INFO] 发现更优模型，已保存至 ./logs/smd_all/best_model.pt
[2025-12-03 18:39:58,599] [INFO] 已保存可视化图：./logs/smd_all/scores_epoch6.png
[2025-12-03 18:39:58,599] [INFO] ========== Epoch 7/50 ==========
[2025-12-03 18:47:01,063] [INFO] 本 epoch 平均训练损失: 0.421430
[2025-12-03 18:51:29,291] [INFO] [Eval] F1=0.8728, P=0.8898, R=0.8563, AUC=0.7479, thr=3.316642, point_adjust=True
[2025-12-03 18:51:29,537] [INFO] 已保存可视化图：./logs/smd_all/scores_epoch7.png
[2025-12-03 18:51:29,537] [INFO] ========== Epoch 8/50 ==========
[2025-12-03 18:58:39,478] [INFO] 本 epoch 平均训练损失: 0.420968
[2025-12-03 19:03:10,848] [INFO] [Eval] F1=0.8684, P=0.8836, R=0.8537, AUC=0.7495, thr=3.604021, point_adjust=True
[2025-12-03 19:03:11,092] [INFO] 已保存可视化图：./logs/smd_all/scores_epoch8.png
[2025-12-03 19:03:11,092] [INFO] ========== Epoch 9/50 ==========
[2025-12-03 19:10:11,451] [INFO] 本 epoch 平均训练损失: 0.420568
[2025-12-03 19:14:40,302] [INFO] [Eval] F1=0.8745, P=0.8738, R=0.8752, AUC=0.7505, thr=2.614912, point_adjust=True
[2025-12-03 19:14:40,546] [INFO] 已保存可视化图：./logs/smd_all/scores_epoch9.png
[2025-12-03 19:14:40,546] [INFO] ========== Epoch 10/50 ==========
[2025-12-03 19:21:39,240] [INFO] 本 epoch 平均训练损失: 0.420214
[2025-12-03 19:26:07,609] [INFO] [Eval] F1=0.8749, P=0.8745, R=0.8752, AUC=0.7516, thr=2.565093, point_adjust=True
[2025-12-03 19:26:07,850] [INFO] 已保存可视化图：./logs/smd_all/scores_epoch10.png
[2025-12-03 19:26:07,850] [INFO] ========== Epoch 11/50 ==========
[2025-12-03 19:33:09,549] [INFO] 本 epoch 平均训练损失: 0.419838
[2025-12-03 19:37:45,506] [INFO] [Eval] F1=0.8737, P=0.8795, R=0.8681, AUC=0.7503, thr=2.726966, point_adjust=True
[2025-12-03 19:37:45,750] [INFO] 已保存可视化图：./logs/smd_all/scores_epoch11.png
[2025-12-03 19:37:45,750] [INFO] ========== Epoch 12/50 ==========
[2025-12-03 19:44:43,774] [INFO] 本 epoch 平均训练损失: 0.419520
[2025-12-03 19:49:17,460] [INFO] [Eval] F1=0.8786, P=0.8820, R=0.8752, AUC=0.7500, thr=2.607615, point_adjust=True
[2025-12-03 19:49:17,562] [INFO] 发现更优模型，已保存至 ./logs/smd_all/best_model.pt
[2025-12-03 19:49:17,799] [INFO] 已保存可视化图：./logs/smd_all/scores_epoch12.png
[2025-12-03 19:49:17,799] [INFO] ========== Epoch 13/50 ==========
[2025-12-03 19:56:15,483] [INFO] 本 epoch 平均训练损失: 0.419369
[2025-12-03 20:00:45,105] [INFO] [Eval] F1=0.8783, P=0.8815, R=0.8752, AUC=0.7462, thr=2.589435, point_adjust=True
[2025-12-03 20:00:45,350] [INFO] 已保存可视化图：./logs/smd_all/scores_epoch13.png
[2025-12-03 20:00:45,350] [INFO] ========== Epoch 14/50 ==========
[2025-12-03 20:07:48,289] [INFO] 本 epoch 平均训练损失: 0.419126
[2025-12-03 20:12:22,934] [INFO] [Eval] F1=0.8761, P=0.8768, R=0.8755, AUC=0.7470, thr=2.484931, point_adjust=True
[2025-12-03 20:12:23,177] [INFO] 已保存可视化图：./logs/smd_all/scores_epoch14.png
[2025-12-03 20:12:23,177] [INFO] ========== Epoch 15/50 ==========
[2025-12-03 20:19:23,894] [INFO] 本 epoch 平均训练损失: 0.418949
[2025-12-03 20:23:57,620] [INFO] [Eval] F1=0.8787, P=0.8821, R=0.8752, AUC=0.7468, thr=2.578179, point_adjust=True
[2025-12-03 20:23:57,866] [INFO] 已保存可视化图：./logs/smd_all/scores_epoch15.png
[2025-12-03 20:23:57,866] [INFO] ========== Epoch 16/50 ==========
